!function(t,i,e,n){"use strict";function o(i,n){this.settings=e.extend({},e.fn[s].defaults,n||{}),this._element=i,this._scrollElement=i.is("body")?t:i,this._init()}if(e){var s="infiniteList",a=".yu.infiniteList",l=(e.fn[s],{SCROLL:"scroll"+a,CLICK:"click"+a}),r={wrapper:".infinite-list",listData:[],offset:10,activeIndex:0,rowHeight:58,isInfinite:!1,itemTemplate:function(t){return'<div class="infinite-list__item">'+("object"==typeof t?JSON.stringify(t):t)+"</div>"},loadStatusTemplate:{loaded:function(){return"<span>加载更多</span>"},loading:function(){return"<span>加载中...</span>"},loadFail:function(){return"<span>加载失败, 请点击重试</span>"},loadEnd:function(){return"<span>没有更多了</span>"}},onInfinite:function(){}};o.prototype={constructor:o,_init:function(){var t=this;t.$scrollElenent=e(t._scrollElement),t.$wrapper=e(t.settings.wrapper),t.$listContent=e('<div class="infinite-list__content">'),t.$listHeader=e('<div class="infinite-list__header">'),t.$listBody=e('<div class="infinite-list__body">'),t.$listFooter=e('<div class="infinite-list__footer">'),t.$listStatus=e('<div class="infinite-list__status">'),t._data=t.settings.listData,t._previewData=[],t._lineTopHeight=0,t._lineBottomHeight=0,t._from=0,t._to=0,t._displayCount=0,t._activeIndex=t.settings.activeIndex,t._loadStatus=t.settings.isInfinite?"loaded":"loadEnd",t._lastScrollTop=0,t._wrapperHeight=t.$wrapper.height(),t._rowHeight=t.settings.rowHeight,t._rowsInWindow=Math.ceil(t._wrapperHeight/t._rowHeight),t._above=2*t._rowsInWindow,t._below=t._rowsInWindow,t.locateTimer=null,t._renderBaseDOM(),t._showPreviewList(t._activeIndex),t._bindEvents()},_bindEvents:function(){var t=this,i=null;t.$scrollElenent.on(l.SCROLL,function(e){e.stopPropagation(),i||(i=setTimeout(function(){clearTimeout(i),i=null,t._showPreviewList()},50))}),t.$listStatus.on(l.CLICK,function(){"loadFail"===t._loadStatus&&(t.setLoadStatus("loading"),"function"==typeof t.settings.onInfinite&&t.settings.onInfinite(t))})},_showPreviewList:function(i){var e=this;void 0!==i&&e.locate(i);var n=e.$scrollElenent.scrollTop();e._lastScrollTop=n;var o=e.$wrapper.height(),s=e.$listContent.height()-o;if(n+=e.settings.offset,e._scrollElement===t){n-=e.$wrapper.position().top}var a=n/e._rowHeight;if(a-Math.floor(a)>.5?e._displayCount=Math.ceil(a):e._displayCount=Math.floor(a),e._from=e._getRange(n).from,e._to=e._getRange(n).to,e._lineTopHeight=e._from*e._rowHeight,e._lineBottomHeight=(e._data.length-e._to)*e._rowHeight,e._reRenderPreviewList(e._from,e._to),n>=s){if("loading"===e._loadStatus||"loadEnd"===e._loadStatus)return;e.setLoadStatus("loading"),"function"==typeof e.settings.onInfinite&&e.settings.onInfinite(e)}},_reRenderPreviewList:function(t,i){this._previewData=[];for(var e=t;e<i;e++)this._previewData.push(this._data[e]);this._renderList(this._previewData),this._resetStyle()},_renderList:function(t){this.$listBody.html(this._getListsContentHtml(t))},_getListsContentHtml:function(t){for(var i=[],e=0;e<t.length;e++){var n=this.settings.itemTemplate(t[e]);i.push(n)}return i.join("")},setLoadStatus:function(t){var i=this;if(i._loadStatus!==t){({loaded:function(){i.$listStatus.html(i.settings.loadStatusTemplate.loaded())},loading:function(){i.$listStatus.html(i.settings.loadStatusTemplate.loading())},loadFail:function(){i.$listStatus.html(i.settings.loadStatusTemplate.loadFail())},loadEnd:function(){i.$listStatus.html(i.settings.loadStatusTemplate.loadEnd())}})[t](),i._loadStatus=t}},_resetStyle:function(){this.$listContent.css({"padding-top":this._lineTopHeight,"padding-bottom":this._lineBottomHeight})},_getRange:function(t){var i=parseInt(t/this._rowHeight)-this._above;i<0&&(i=0);var e=i+this._above+this._below+this._rowsInWindow;return e>this._data.length&&(e=this._data.length),{from:i,to:e}},pushData:function(t){var i=this;i._data.push.apply(i._data,t),i._showPreviewList(i._activeIndex),setTimeout(function(){i.$scrollElenent.scrollTop(i._lastScrollTop)},10)},locate:function(t){var i=this;i.settings.activeIndex=parseInt(t);var e=i.$scrollElenent.scrollTop(),n=t*i._rowHeight;n!==e&&(clearTimeout(i.locateTimer),i.locateTimer=setTimeout(function(){i.$scrollElenent.scrollTop(n)},0))},_renderBaseDOM:function(){var t=this,i=t.settings.isInfinite?t.settings.loadStatusTemplate.loaded():t.settings.loadStatusTemplate.loadEnd();t.$listStatus.append(i),t.$listFooter.append(t.$listStatus),t.$listContent.append(t.$listHeader),t.$listContent.append(t.$listBody),t.$listContent.append(t.$listFooter),t.$wrapper.append(t.$listContent)}},e.fn[s]=function(i){var n,a=this;return this.each(function(){var l=e(this),r=t.jQuery?l.data(s):e.fn[s].lookup[l.data(s)];r?n=new o(l,i):(n=new o(l,i),t.jQuery?l.data(s,n):(e.fn[s].lookup[++e.fn[s].lookup.i]=n,l.data(s,e.fn[s].lookup.i),r=e.fn[s].lookup[l.data(s)])),"string"==typeof i&&r[i](),a.pushData=function(t){n.pushData(t)},a.setLoadStatus=function(t){n.setLoadStatus(t)},a.locate=function(t){n.locate(t)}})},t.jQuery||(e.fn[s].lookup={i:0}),e.fn[s].defaults=r}}(window,document,window.jQuery||window.Zepto);